Metadata-Version: 2.4
Name: diaremot
Version: 2.1.0
Summary: DiaRemot CPU-only speech affect and transcription pipeline
License: Proprietary
Keywords: speech,diarization,emotion,cli
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: numpy==1.24.4
Requires-Dist: scipy==1.10.1
Requires-Dist: librosa==0.10.2.post1
Requires-Dist: numba==0.59.1
Requires-Dist: llvmlite==0.42.0
Requires-Dist: resampy==0.4.2
Requires-Dist: soundfile==0.12.1
Requires-Dist: av==11.0.0
Requires-Dist: torch==2.4.1+cpu
Requires-Dist: torchaudio==2.4.1+cpu
Requires-Dist: torchvision==0.19.1+cpu
Requires-Dist: ctranslate2==4.6.0
Requires-Dist: faster-whisper==1.1.0
Requires-Dist: openai-whisper==20231117
Requires-Dist: transformers==4.38.2
Requires-Dist: onnxruntime==1.17.1
Requires-Dist: tokenizers==0.15.2
Requires-Dist: huggingface_hub==0.24.6
Requires-Dist: pandas==2.0.3
Requires-Dist: scikit-learn==1.3.2
Requires-Dist: audioread==3.0.1
Requires-Dist: pydub==0.25.1
Requires-Dist: ffmpeg-python==0.2.0
Requires-Dist: matplotlib==3.7.5
Requires-Dist: seaborn==0.13.2
Requires-Dist: reportlab==4.1.0
Requires-Dist: praat-parselmouth==0.4.3
Requires-Dist: jinja2==3.1.6
Requires-Dist: beautifulsoup4==4.12.3
Requires-Dist: tqdm==4.66.4
Requires-Dist: joblib==1.3.2
Requires-Dist: psutil==5.9.8
Requires-Dist: packaging==23.2
Requires-Dist: panns-inference==0.1.1
Requires-Dist: click==8.1.7
Requires-Dist: typer==0.9.0

# DiaRemot - Codex Cloud Quickstart (Ubuntu + apt)

IMPORTANT: Use These Pinned Versions
- Always activate the repo venv and `pip install -r requirements.txt`.
- Do NOT upgrade packages; the pipeline is validated on these exact pins:
  - onnxruntime==1.17.1
  - faster-whisper==1.1.0, ctranslate2==4.6.0
  - transformers==4.38.2, tokenizers==0.15.2
  - torch==2.4.1+cpu, torchaudio==2.4.1+cpu, torchvision==0.19.1+cpu
  - librosa==0.10.2.post1, numpy==1.24.4, scipy==1.10.1, numba==0.59.1, llvmlite==0.42.0
  - pandas==2.0.3, scikit-learn==1.3.2
  - praat-parselmouth==0.4.3, panns-inference==0.1.1

Quick check after setup:
```
python - <<'PY'
from importlib.metadata import version
assert version('onnxruntime')=='1.17.1'
assert version('faster-whisper')=='1.1.0'
assert version('ctranslate2')=='4.6.0'
assert version('transformers')=='4.38.2'
assert version('tokenizers')=='0.15.2'
print('Pins OK')
PY
```

This guide is a Codex-Cloud–specific companion to the main README. It assumes an Ubuntu-like runner with `apt` available and focuses on reproducible, CPU-only setup with ONNX-first inference.

Prereqs
- Ubuntu-like environment with `apt`
- Python 3.9–3.11
- Git access to this repo

1) System Utilities (allowed on Codex Cloud)
```
sudo apt-get update -qq
sudo apt-get install -y ffmpeg
```

2) Create and Activate the Virtualenv
```
python3 -m venv .venv
source .venv/bin/activate
python -m pip install --upgrade pip setuptools wheel
```

3) Install Pinned Python Dependencies
```
python -m pip install -r requirements.txt
```

4) Cache & Environment Defaults
```
export CACHE_ROOT="$(pwd)/.cache"
mkdir -p "$CACHE_ROOT" "$CACHE_ROOT/hf" "$CACHE_ROOT/torch" "$CACHE_ROOT/transformers"
export HF_HOME="$CACHE_ROOT/hf"
export HUGGINGFACE_HUB_CACHE="$CACHE_ROOT/hf"
export TRANSFORMERS_CACHE="$CACHE_ROOT/transformers"
export TORCH_HOME="$CACHE_ROOT/torch"
export XDG_CACHE_HOME="$CACHE_ROOT"
export DIAREMOT_MODEL_DIR="$(pwd)/.cache/models"
export OMP_NUM_THREADS=${OMP_NUM_THREADS:-4}
export MKL_NUM_THREADS=${MKL_NUM_THREADS:-4}
export NUMEXPR_MAX_THREADS=${NUMEXPR_MAX_THREADS:-4}
export TOKENIZERS_PARALLELISM=false
export CUDA_VISIBLE_DEVICES=""; export TORCH_DEVICE=cpu
```

5) Stage Models (Use Your GitHub Release Asset)
- Recommended: Provide a signed `models.zip` release. Then:
```
export DIAREMOT_AUTO_DOWNLOAD=1
export DIAREMOT_MODELS_URL="https://github.com/OWNER/REPO/releases/download/TAG/models.zip"
export DIAREMOT_MODELS_SHA256="<sha256-hex>"
```
- Or place `models.zip` at repo root, or pre-populate `DIAREMOT_MODEL_DIR` with files.
- Expected files:
  - panns_cnn14.onnx, audioset_labels.csv
  - silero_vad.onnx, ecapa_tdnn.onnx
  - ser_8class.onnx, vad_model.onnx
  - roberta-base-go_emotions.onnx, bart-large-mnli.onnx

6) One-Command Setup
Use the repo script (Codex Cloud–aware). It will install Python deps, ensure env defaults, and fetch/unpack models if configured. It also bootstraps ffmpeg via imageio-ffmpeg when apt is unavailable.
```
chmod +x ./setup.sh
./setup.sh
```

7) Smoke Test
```
python -m diaremot.cli run \
  --input data/sample.wav \
  --outdir ./outputs \
  --asr-compute-type float32
```

Notes
- CPU-only: The pipeline uses `CPUExecutionProvider` for ONNXRuntime and CTranslate2 on CPU.
- If you prefer apt-installed ffmpeg (Codex Cloud): already covered in step 1. The setup script will otherwise provide a portable ffmpeg via `imageio-ffmpeg` in `./.cache/bin`.
- Verify deps quickly:
```
python -m diaremot.pipeline.audio_pipeline_core --verify_deps --strict_dependency_versions
```

## Adaptive VAD Overrides (Orchestrator vs CLI)

The orchestrator tightens diarization defaults when the CLI does **not** specify overrides. This reduces micro-segments in noisy recordings but can be relaxed via flags:

| Parameter | CLI default | Orchestrator auto-tune | Override flag |
|-----------|-------------|------------------------|---------------|
| `vad_threshold` | 0.30 | **0.35** | `--vad-threshold` |
| `vad_min_speech_sec` | 0.80 s | **0.80 s** (unchanged) | `--vad-min-speech-sec` |
| `vad_min_silence_sec` | 0.80 s | **0.80 s** (unchanged) | `--vad-min-silence-sec` |
| `vad_speech_pad_sec` | 0.20 s | **0.10 s** | `--vad-speech-pad-sec` |

To keep the original CLI defaults, supply all four flags explicitly:

```bash
python -m diaremot.cli run --input data/sample.wav --outdir outputs/ \
  --vad-threshold 0.30 \
  --vad-min-speech-sec 0.80 \
  --vad-min-silence-sec 0.80 \
  --vad-speech-pad-sec 0.20
```

All values verified in `src/diaremot/pipeline/orchestrator.py::_init_components` (strict overrides applied only when a value is absent from the merged config).

Troubleshooting
- Torch `_C` import errors: ensure you used the venv created here; the code lazily imports heavy backends now.
- Librosa lazy_loader error: the code imports `librosa` module and uses `librosa.func` style, which avoids the issue. Ensure you’re on the pinned versions from `requirements.txt`.
